<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>å°ç™½ä¸ªäººè®°è´¦æœ¬</title>
    <style>
        .background {
            min-height: 100vh;
            background-image: url("/static/img/acct_backg.png");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        .bton {
            width: 700px;
            margin: 20px auto 0;
        }

        .query {
            width: 700px;
            margin: 15px auto;
            text-align: center;
        }

        .tables {
            width: 90%;
            margin: 20px auto;
        }
    </style>

    <link rel="stylesheet" href="/static/plugins/bootstrap-5.3.8/css/bootstrap.css"/>
    <link rel="stylesheet" href="/static/plugins/fontawesome-free-6.4.0-web/css/all.css">
</head>
<body>
<div class="background">
    <div class="header">
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fa-regular fa-receipt"></i>
                    <span>å°ç™½ä¸ªäººè®°è´¦æœ¬</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarSupportedContent"
                        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="#">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Link</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                               aria-expanded="false">
                                Dropdown
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Action</a></li>
                                <li><a class="dropdown-item" href="#">Another action</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="#">Something else here</a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link disabled" aria-disabled="true">Disabled</a>
                        </li>
                    </ul>
                    <form class="d-flex" role="search">
                        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search"/>
                        <button class="btn btn-outline-success" type="submit">Search</button>
                    </form>
                </div>
            </div>
        </nav>
    </div>

    <!-- æŸ¥è¯¢åŒºåŸŸ -->
    <div class="query">
        <form class="d-inline" method="get" action="/user/account">
            <label for="date">æŸ¥è¯¢æ—¥æœŸï¼š</label>
            <input type="date" name="date" id="date" value="{{ date or '' }}">
            <button type="submit" class="btn btn-outline-secondary btn-sm">ğŸ” æŸ¥è¯¢</button>
            {% if date %}
            <a href="/user/account" class="btn btn-outline-dark btn-sm ms-2">â†º æ˜¾ç¤ºå…¨éƒ¨</a>
            {% endif %}
        </form>
    </div>

    <!-- æŒ‰é’®åŒºåŸŸ -->
    <div class="bton">
        <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#add">
            <i class="fas fa-plus"></i> æ’å…¥
        </button>
    </div>

    <!-- è®°è´¦è¡¨æ ¼ -->
    <div class="tables">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th scope="col">ID</th>
                    <th scope="col">é‡‘é¢</th>
                    <th scope="col">ç±»å‹</th>
                    <th scope="col">åˆ†ç±»</th>
                    <th scope="col">æ—¥æœŸ</th>
                    <th scope="col">æè¿°</th>
                    <th scope="col">æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="body">
                <!-- æ•°æ®ç”±JSåŠ¨æ€å¡«å…… -->
            </tbody>
        </table>
    </div>

    <!-- æ–°å¢è®°å½•æ¨¡æ€æ¡† -->
    <div class="modal fade" id="add" tabindex="-1" aria-labelledby="addLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="POST" action="/user/account">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addLabel">æ–°å¢è®°è´¦è®°å½•</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="action" value="add">
                        <div class="mb-3">
                            <label for="amount" class="form-label">é‡‘é¢</label>
                            <input type="number" step="0.01" class="form-control" name="amount" id="amount" required>
                        </div>
                        <div class="mb-3">
                            <label for="type" class="form-label">ç±»å‹ï¼ˆæ”¶å…¥/æ”¯å‡ºï¼‰</label>
                            <select class="form-select" name="type" id="type" required>
                                <option value="æ”¶å…¥">æ”¶å…¥</option>
                                <option value="æ”¯å‡º">æ”¯å‡º</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="category" class="form-label">åˆ†ç±»</label>
                            <input type="text" class="form-control" name="category" id="category"
                                   placeholder="å¦‚é¤é¥®ã€äº¤é€šã€ä½å®¿..." required>
                        </div>
                        <div class="mb-3">
                            <label for="date" class="form-label">æ—¥æœŸ</label>
                            <input type="date" class="form-control" name="date" id="date" value="{{ today }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">æè¿°ï¼ˆå¯é€‰ï¼‰</label>
                            <textarea class="form-control" name="description" id="description"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- åˆ é™¤ç¡®è®¤æ¨¡æ€æ¡† -->
    <div class="modal fade" id="del_Modal" tabindex="-1" aria-labelledby="del_ModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="del_ModalLabel">ç¡®è®¤åˆ é™¤</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚
                    <form id="del_Form" method="post" action="/user/account" style="display:none;">
                        <input type="hidden" name="action" value="delete">
                        <input type="hidden" name="record_id" id="del_RecordId">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-danger"
                            onclick="document.getElementById('del_Form').submit()">åˆ é™¤</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘è®°å½•æ¨¡æ€æ¡† -->
    <div class="modal fade" id="edit_Modal" tabindex="-1" aria-labelledby="edit_ModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="/user/account" id="edit_Form">
                    <div class="modal-header">
                        <h5 class="modal-title" id="edit_ModalLabel">ç¼–è¾‘è®°è´¦è®°å½•</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="action" value="update">
                        <input type="hidden" name="record_id" id="edit_RecordId">
                        <div class="mb-3">
                            <label class="form-label">é‡‘é¢</label>
                            <input type="number" step="0.01" name="amount" id="edit_Amount" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ç±»å‹</label>
                            <select name="type" id="edit_Type" class="form-select" required>
                                <option value="æ”¯å‡º">æ”¯å‡º</option>
                                <option value="æ”¶å…¥">æ”¶å…¥</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">åˆ†ç±»</label>
                            <input type="text" name="category" id="edit_Category" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">æ—¥æœŸ</label>
                            <input type="date" name="date" id="edit_Date" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">æè¿°</label>
                            <textarea name="description" id="edit_Description" class="form-control"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">æ›´æ–°</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="/static/plugins/bootstrap-5.3.8/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript">
    // ä¿®å¤Jinja2å˜é‡æ¸²æŸ“å’Œå¤§å°å†™é—®é¢˜
    var datalist = {{ data_list | tojson }};

    var tbody = document.getElementById("body");
    tbody.innerHTML = ""; // ä¿®æ­£ä¸ºinnerHTML

    for (var i = 0; i < datalist.length; i++) {
        var record = datalist[i];
        var tr = document.createElement("tr");

        // ä¿®å¤å›¾æ ‡ç±»åï¼ˆä½¿ç”¨Font Awesome 6æ ‡å‡†ï¼‰
        tr.innerHTML = `
            <td>${record.id}</td>
            <td>${record.amount}</td>
            <td>${record.type}</td>
            <td>${record.category}</td>
            <td>${record.date}</td>
            <td>${record.description || ''}</td>
            <td>
                <button type="button" class="btn btn-sm btn-outline-primary me-1"
                        onclick="openEditModal(${JSON.stringify(record)})">
                    <i class="fas fa-pen-to-square"></i> <!-- FA6ç¼–è¾‘å›¾æ ‡ -->
                </button>
                <button type="button" class="btn btn-sm btn-outline-danger"
                        onclick="openDeleteModal(${record.id})">
                    <i class="fas fa-trash-can"></i> <!-- FA6åˆ é™¤å›¾æ ‡ -->
                </button>
            </td>
        `;
        tbody.appendChild(tr);
    }

    // ä¿®å¤åˆ é™¤æ¨¡æ€æ¡†å‡½æ•°ï¼ˆä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„IDï¼‰
    function openDeleteModal(recordId) {
        document.getElementById('del_RecordId').value = recordId;
        var deleteModal = new bootstrap.Modal(document.getElementById('del_Modal'));
        deleteModal.show();
    }

    // ä¿®å¤ç¼–è¾‘æ¨¡æ€æ¡†å‡½æ•°ï¼ˆä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„å¸¦ä¸‹åˆ’çº¿IDï¼‰
    function openEditModal(record) {
        document.getElementById('edit_RecordId').value = record.id;
        document.getElementById('edit_Amount').value = record.amount;
        document.getElementById('edit_Type').value = record.type;
        document.getElementById('edit_Category').value = record.category;
        document.getElementById('edit_Date').value = record.date;
        document.getElementById('edit_Description').value = record.description || '';

        var editModal = new bootstrap.Modal(document.getElementById('edit_Modal'));
        editModal.show();
    }
</script>
</body>
</html>